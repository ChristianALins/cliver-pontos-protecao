<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <title>Clube de Vantagens - CLIVER CORRETORA DE SEGUROS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; margin: 0; padding: 20px; color: #333; }
        .container { max-width: 1400px; margin: 0 auto; }
        .header { background: white; padding: 20px 24px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px; }
        .header h1 { margin: 0; color: #667eea; font-size: 24px; }
        .header small { display: block; color: #777; margin-top: 4px; font-size: 12px; }
        .header-actions { display: flex; flex-wrap: wrap; gap: 8px; }
        .btn { padding: 8px 14px; border-radius: 6px; border: none; cursor: pointer; font-size: 13px; font-weight: 600; transition: all 0.2s; }
        .btn-primary { background: #667eea; color: #fff; }
        .btn-primary:hover { background: #5568d3; box-shadow: 0 2px 8px rgba(102,126,234,0.4); transform: translateY(-1px); }
        .btn-outline { background: #fff; color: #667eea; border: 1px solid #667eea; }
        .btn-outline:hover { background: #eef2ff; }
        .nav-tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .nav-tabs button { background: white; border: 2px solid #ddd; padding: 10px 18px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.2s; }
        .nav-tabs button.active { background: #667eea; color: white; border-color: #667eea; }
        .tab-content { display: none; animation: fadeIn 0.25s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }
        .form-group { background: white; padding: 18px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.04); }
        .form-group h2 { margin: 0 0 12px 0; font-size: 18px; }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(230px, 1fr)); gap: 14px; margin-bottom: 14px; }
        label { display: block; margin-bottom: 6px; font-weight: 600; font-size: 13px; color: #333; }
        input, select { width: 100%; padding: 8px 10px; border-radius: 6px; border: 2px solid #eee; font-size: 14px; box-sizing: border-box; transition: border-color 0.2s; }
        input:focus, select:focus { outline: none; border-color: #667eea; }
        .table { width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.05); font-size: 13px; }
        .table thead { background: #f7f9fc; border-bottom: 2px solid #eee; }
        .table th, .table td { padding: 10px; text-align: left; }
        .table th { font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; color: #667eea; }
        .table tbody tr:nth-child(even) { background: #fafbff; }
        .table tbody tr:hover { background: #f2f4ff; }
        .badge-pontos { display: inline-block; background: #667eea; color: #fff; padding: 6px 10px; border-radius: 999px; font-size: 12px; font-weight: 600; }
        .btn-sm-danger { background: #f56565; color: #fff; border: none; padding: 6px 10px; border-radius: 4px; font-size: 11px; cursor: pointer; }
        .btn-sm-danger:hover { background: #e53e3e; }
        .info-box { background: #e6fffa; border-left: 4px solid #38b6a3; padding: 12px; border-radius: 6px; margin-bottom: 12px; font-size: 13px; color: #134e4a; }
        .tag { display: inline-block; padding: 3px 8px; border-radius: 999px; font-size: 11px; }
        .tag-ganho { background: #c6f6d5; color: #22543d; }
        .tag-resgate { background: #fed7d7; color: #742a2a; }
        .points-bar { background: #eee; border-radius: 999px; height: 12px; overflow: hidden; margin-top: 8px; }
        .points-bar-fill { background: linear-gradient(90deg, #667eea, #764ba2); height: 100%; transition: width 0.4s; }
        .muted { font-size: 12px; color: #666; }
        .grid-2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 16px; }
        .stat-box { text-align: left; }
        .stat-box h3 { margin: 0; color: #999; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px; }
        .stat-box .value { font-size: 24px; font-weight: bold; color: #667eea; }
        @media (max-width: 768px) { .header { flex-direction: column; align-items: flex-start; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>Clube de Vantagens ‚Äì CLIVER CORRETORA DE SEGUROS</h1>
                <small>Programa de Pontos de Prote√ß√£o ‚Äì Renovar, Comprar Mais e Indicar</small>
            </div>
            <div class="header-actions">
                <button class="btn btn-outline" onclick="exportarDados()">Backup JSON</button>
                <button class="btn btn-outline" onclick="exportarCSV()">Exportar CSV (Planilhas)</button>
                <button class="btn btn-outline" onclick="document.getElementById('inputImportar').click()">Importar backup</button>
                <input type="file" id="inputImportar" accept="application/json" style="display:none" />
            </div>
        </div>

        <nav class="nav-tabs">
            <button class="active" onclick="mudarAba('clientes', event)">üë• Meus Clientes</button>
            <button onclick="mudarAba('acumulo', event)">‚ûï Acumular Pontos</button>
            <button onclick="mudarAba('resgate', event)">üí≥ Processar Resgate</button>
            <button onclick="mudarAba('historico', event)">üìä Hist√≥rico</button>
            <button onclick="mudarAba('relatorio', event)">üìà Relat√≥rio</button>
        </nav>

        <div id="clientes" class="tab-content active">
            <div class="form-group">
                <h2>Adicionar Novo Cliente</h2>
                <div class="form-row">
                    <div>
                        <label>Nome do Cliente</label>
                        <input type="text" id="nomeCliente" placeholder="Ex: Jo√£o Silva" />
                    </div>
                    <div>
                        <label>Email</label>
                        <input type="email" id="emailCliente" placeholder="Ex: joao@email.com" />
                    </div>
                    <div>
                        <label>Telefone</label>
                        <input type="tel" id="telefoneCliente" placeholder="Ex: 11 98765-4321" />
                    </div>
                    <div>
                        <label>CPF</label>
                        <input type="text" id="cpfCliente" placeholder="Somente n√∫meros" />
                    </div>
                </div>
                <div class="form-row">
                    <div>
                        <label>Tipo de Seguro Principal</label>
                        <select id="tipoSeguro">
                            <option>Selecione...</option>
                            <option>Auto</option>
                            <option>Residencial</option>
                            <option>Vida</option>
                            <option>Empresarial</option>
                            <option>Outro</option>
                        </select>
                    </div>
                    <div>
                        <label>Data de Filia√ß√£o</label>
                        <input type="date" id="dataFiliacao" />
                    </div>
                </div>
                <button class="btn btn-primary" onclick="adicionarCliente()">‚ûï Adicionar Cliente</button>
                <p class="muted" style="margin-top: 8px;">CPF n√£o pode se repetir. Todos os campos s√£o obrigat√≥rios.</p>
            </div>

            <div class="form-group">
                <h2>Seus Clientes</h2>
                <div id="listaClientes"></div>
            </div>
        </div>

        <div id="acumulo" class="tab-content">
            <div class="form-group">
                <h2>Adicionar Pontos ao Cliente</h2>
                <div class="info-box">
                    Paridade: 10 Pontos = R$ 1,00 de desconto. Use pontos para incentivar renova√ß√£o antecipada, 2¬∫ produto, indica√ß√£o e aulas.
                </div>
                <div class="form-row">
                    <div>
                        <label>Selecione o Cliente</label>
                        <select id="clienteAcumulo">
                            <option>Carregando...</option>
                        </select>
                    </div>
                </div>
                <div style="margin-top: 16px; padding: 12px; background:#f9fafb; border-radius:8px;">
                    <h3 style="margin:0 0 10px 0; color:#667eea;">A√ß√µes e Pontua√ß√£o</h3>
                    <div class="info-box" style="margin-bottom:10px;">
                        Escolha uma a√ß√£o abaixo. Os pontos ser√£o somados automaticamente ao saldo do cliente e registrados no hist√≥rico.
                    </div>
                    <div class="form-row">
                        <label>
                            <input type="radio" name="tipoAcumulo" value="renovacao" onclick="atualizarDescricaoAcumulo()" />
                            üîÑ Renova√ß√£o Antecipada (5 dias antes)
                            <span class="muted">500 Pontos (R$ 50,00) ‚Äì incentiva o cliente a renovar antes.</span>
                        </label>
                        <label>
                            <input type="radio" name="tipoAcumulo" value="produto2" onclick="atualizarDescricaoAcumulo()" />
                            üìã Contrata√ß√£o de 2¬∫ Produto
                            <span class="muted">1.000 Pontos (R$ 100,00) ‚Äì cross-sell de Vida, Residencial, Empresarial.</span>
                        </label>
                    </div>
                    <div class="form-row">
                        <label>
                            <input type="radio" name="tipoAcumulo" value="indicacao" onclick="atualizarDescricaoAcumulo()" />
                            üë• Indica√ß√£o Efetivada
                            <span class="muted">1.500 Pontos (R$ 150,00) ‚Äì CAC baixo para cliente novo.</span>
                        </label>
                        <label>
                            <input type="radio" name="tipoAcumulo" value="aula" onclick="atualizarDescricaoAcumulo()" />
                            üéì Aluno da Aula Habilitado
                            <span class="muted">200 Pontos (R$ 20,00) ‚Äì incentivo simb√≥lico.</span>
                        </label>
                    </div>
                    <div class="form-row">
                        <label>
                            <input type="radio" name="tipoAcumulo" value="customizado" onclick="atualizarDescricaoAcumulo()" />
                            ‚ú® Pontua√ß√£o Customizada
                            <span class="muted">Use para campanhas especiais ou acordos espec√≠ficos.</span>
                        </label>
                    </div>
                    <div id="areaCustomizada" style="display:none; margin-top:10px;">
                        <div class="form-row">
                            <div>
                                <label>Quantidade de Pontos</label>
                                <input type="number" id="pontosCustomizados" min="1" placeholder="Ex: 750" />
                            </div>
                            <div>
                                <label>Motivo / Descri√ß√£o</label>
                                <input type="text" id="motivoCustomizado" placeholder="Ex: Campanha especial de anivers√°rio" />
                            </div>
                        </div>
                    </div>
                    <div class="form-row" style="margin-top: 14px;">
                        <div>
                            <label>Observa√ß√µes (opcional)</label>
                            <input type="text" id="observacaoAcumulo" placeholder="Ex: Renova√ß√£o aprovada em 02/01/2026" />
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="adicionarPontos()" style="margin-top: 16px;">‚úÖ Confirmar Adi√ß√£o de Pontos</button>
                </div>
            </div>
        </div>

        <div id="resgate" class="tab-content">
            <div class="form-group">
                <h2>Processar Resgate de Pontos</h2>
                <div class="info-box">
                    Conceito: o dinheiro n√£o sai do caixa, ele gira dentro do seu ecossistema (descontos, aulas, parceiros locais).
                </div>
                <div class="form-row">
                    <div>
                        <label>Selecione o Cliente</label>
                        <select id="clienteResgate">
                            <option>Carregando...</option>
                        </select>
                    </div>
                </div>
                <div id="infoClienteResgate" style="margin-top: 12px;"></div>
                <div style="margin-top: 16px; padding: 12px; background:#f9fafb; border-radius:8px;">
                    <h3 style="margin:0 0 10px 0; color:#667eea;">Op√ß√µes de Resgate</h3>
                    <div style="margin-top:8px;">
                        <label>
                            <input type="radio" name="tipoResgate" value="desconto-renovacao" onclick="atualizarResgate()" />
                            üí≥ Op√ß√£o A (Ouro): Desconto na Renova√ß√£o
                            <span class="muted">Cliente usa pontos para abater o pre√ßo do seguro. Voc√™ aplica desconto comercial.</span>
                        </label>
                    </div>
                    <div style="margin-top:8px;">
                        <label>
                            <input type="radio" name="tipoResgate" value="aula-consultoria" onclick="atualizarResgate()" />
                            üéì Op√ß√£o B (Servi√ßo): Aula/Consultoria
                            <span class="muted">Dire√ß√£o defensiva, consultoria de coberturas, webinars, etc. Custo financeiro zero.</span>
                        </label>
                    </div>
                    <div style="margin-top:8px;">
                        <label>
                            <input type="radio" name="tipoResgate" value="parceiros" onclick="atualizarResgate()" />
                            ü§ù Op√ß√£o C (Parceiros): Parceiros Locais
                            <span class="muted">Lava-r√°pido, oficina, restaurante, etc. Voc√™ negocia e economiza.</span>
                        </label>
                    </div>

                    <div id="detalheResgate" style="margin-top: 18px; display:none;">
                        <div class="form-row">
                            <div>
                                <label>Quantidade de Pontos para Resgatar</label>
                                <input type="number" id="pontosResgate" min="10" step="10" onchange="atualizarEquivalente()" />
                                <span class="muted">Equival√™ncia: 10 pontos = R$ 1,00</span>
                            </div>
                            <div>
                                <label>Equivalente em R$</label>
                                <input type="text" id="equivalenteResgate" disabled placeholder="R$ 0,00" style="background:#f5f5f5;" />
                            </div>
                        </div>
                        <div id="detalhesEspecificos"></div>
                        <div class="form-row" style="margin-top: 10px;">
                            <div>
                                <label>Observa√ß√µes</label>
                                <input type="text" id="observacaoResgate" placeholder="Ex: Voucher enviado por e-mail" />
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="confirmarResgate()" style="margin-top: 16px;">‚úÖ Processar Resgate</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="historico" class="tab-content">
            <div class="form-group">
                <h2>Hist√≥rico Completo de Movimenta√ß√µes</h2>
                <div class="form-row" style="margin-bottom: 10px;">
                    <div>
                        <label>Filtrar por Cliente</label>
                        <select id="filtroHistorico" onchange="atualizarHistorico()">
                            <option value="">Todos os Clientes</option>
                        </select>
                    </div>
                </div>
                <div id="tabelaHistorico"></div>
            </div>
        </div>

        <div id="relatorio" class="tab-content">
            <div class="grid-2">
                <div class="form-group">
                    <h2>üìä Resumo Geral</h2>
                    <p>Total de Clientes: <span id="relClientes">0</span></p>
                    <p>Pontos em Circula√ß√£o: <span id="relPontosCirculacao">0</span></p>
                    <p>Pontos Resgatados: <span id="relPontosResgatados">0</span></p>
                    <p>Taxa de Resgate: <span id="relTaxaResgate">0%</span></p>
                </div>
                <div class="form-group">
                    <h2>üí∞ Estimativa Financeira</h2>
                    <p>Investimento Total Estimado: <span id="relInvestimento">R$ 0,00</span></p>
                    <p class="muted">Baseado em 10 pontos = R$ 1,00.</p>
                </div>
            </div>

            <div class="form-group" style="margin-top: 16px;">
                <h2>üéØ Pontos por Tipo de A√ß√£o</h2>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Tipo de A√ß√£o</th>
                            <th>Quantidade de Vezes</th>
                            <th>Total de Pontos</th>
                            <th>Equivalente R$</th>
                        </tr>
                    </thead>
                    <tbody id="tabelaTiposAcao">
                        <tr><td colspan="4" style="text-align:center; color:#999;">Carregando...</td></tr>
                    </tbody>
                </table>
            </div>

            <div class="form-group" style="margin-top: 16px;">
                <h2>üèÜ Top Clientes com Mais Pontos</h2>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Cliente</th>
                            <th>Pontos</th>
                            <th>Equivalente R$</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="tabelaTopClientes">
                        <tr><td colspan="4" style="text-align:center; color:#999;">Carregando...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'programaPontosProtecao_v1';
        let estadoApp = { clientes: [], movimentos: [] };

        function salvarEstado() {
            try { localStorage.setItem(STORAGE_KEY, JSON.stringify(estadoApp)); }
            catch (e) { console.error('Erro ao salvar estado:', e); alert('Erro ao salvar dados localmente.'); }
        }

        function carregarEstado() {
            try {
                const raw = localStorage.getItem(STORAGE_KEY);
                if (!raw) return;
                const dados = JSON.parse(raw);
                estadoApp = {
                    clientes: Array.isArray(dados.clientes) ? dados.clientes : [],
                    movimentos: Array.isArray(dados.movimentos) ? dados.movimentos : []
                };
            } catch (e) { console.error('Erro ao carregar estado:', e); }
        }

        function exportarDados() {
            try {
                const json = JSON.stringify(estadoApp, null, 2);
                const blob = new Blob([json], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                const data = new Date().toISOString().slice(0,10);
                a.href = url;
                a.download = `backup-pontos-protecao-${data}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            } catch (e) { console.error('Erro ao exportar JSON:', e); alert('Erro ao exportar JSON.'); }
        }

        function exportarCSV() {
            try {
                const sep = ';';
                const linhas = [['id','nome','cpf','email','telefone','tipoSeguro','dataCadastro','saldoPontos','saldoEmReais'].join(sep)];
                estadoApp.clientes.forEach(c => {
                    const saldo = c.pontos ?? c.saldoPontos ?? 0;
                    const reais = (saldo / 10).toFixed(2).replace('.', ',');
                    const campos = [c.id, c.nome, c.cpf, c.email || '', c.telefone || '', c.tipoSeguro || '', c.dataFiliacao || c.dataCadastro || '', saldo, reais].map(v => `\"${String(v).replace(/\"/g,'\"\"')}\"`);
                    linhas.push(campos.join(sep));
                });
                const csv = '\ufeff' + linhas.join('
');
                const blob = new Blob([csv], { type:'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                const data = new Date().toISOString().slice(0,10);
                a.href = url;
                a.download = `clientes-pontos-cliver-${data}.csv`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            } catch (e) { console.error('Erro ao exportar CSV:', e); alert('Erro ao exportar CSV.'); }
        }

        document.getElementById('inputImportar').addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = e => {
                try {
                    const dados = JSON.parse(e.target.result);
                    if (!dados || !Array.isArray(dados.clientes) || !Array.isArray(dados.movimentos)) { alert('Arquivo inv√°lido.'); return; }
                    if (!confirm('Importar este backup ir√° substituir os dados atuais. Continuar?')) return;
                    estadoApp = { clientes: dados.clientes, movimentos: dados.movimentos };
                    salvarEstado();
                    atualizarTudo();
                    alert('Dados importados com sucesso!');
                } catch (err) { console.error('Erro ao importar:', err); alert('Erro ao importar. Verifique o arquivo.'); }
                finally { event.target.value = ''; }
            };
            reader.readAsText(file, 'utf-8');
        });

        function mudarAba(id, ev) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-tabs button').forEach(b => b.classList.remove('active'));
            if (ev && ev.target) ev.target.classList.add('active');
        }

        function gerarId() { return Date.now().toString(36) + Math.random().toString(36).substring(2,8); }

        function adicionarCliente() {
            const nome = document.getElementById('nomeCliente').value.trim();
            const email = document.getElementById('emailCliente').value.trim();
            const telefone = document.getElementById('telefoneCliente').value.trim();
            const cpf = document.getElementById('cpfCliente').value.trim();
            const tipoSeguro = document.getElementById('tipoSeguro').value;
            const dataFiliacao = document.getElementById('dataFiliacao').value;

            if (!nome || !email || !telefone || !cpf || !dataFiliacao || tipoSeguro === 'Selecione...') { alert('Preencha todos os campos obrigat√≥rios.'); return; }
            if (estadoApp.clientes.find(c => c.cpf === cpf)) { alert('Este CPF j√° est√° cadastrado.'); return; }

            const novoCliente = { id: gerarId(), nome, email, telefone, cpf, tipoSeguro, dataFiliacao, pontos: 0, criadoEm: new Date().toLocaleDateString('pt-BR') };
            estadoApp.clientes.push(novoCliente);
            salvarEstado();
            limparFormularioCliente();
            atualizarTudo();
            alert('Cliente adicionado com sucesso.');
        }

        function limparFormularioCliente() {
            document.getElementById('nomeCliente').value = '';
            document.getElementById('emailCliente').value = '';
            document.getElementById('telefoneCliente').value = '';
            document.getElementById('cpfCliente').value = '';
            document.getElementById('tipoSeguro').value = 'Selecione...';
            document.getElementById('dataFiliacao').value = '';
        }

        function excluirCliente(clienteId) {
            if (!confirm('Tem certeza que deseja deletar este cliente e todo o hist√≥rico de pontos dele?')) return;
            estadoApp.clientes = estadoApp.clientes.filter(c => c.id !== clienteId);
            estadoApp.movimentos = estadoApp.movimentos.filter(m => m.clienteId !== clienteId);
            salvarEstado();
            atualizarTudo();
            alert('Cliente removido.');
        }

        function atualizarClientesLista() {
            const container = document.getElementById('listaClientes');
            if (!estadoApp.clientes.length) { container.innerHTML = '<p class="muted">Nenhum cliente cadastrado.</p>'; return; }
            container.innerHTML = estadoApp.clientes.map(c => {
                const saldo = c.pontos ?? 0;
                const reais = (saldo / 10).toFixed(2);
                const perc = Math.min((saldo / 2000) * 100, 100);
                return `<div style="background:#fff;border-radius:10px;padding:12px;margin-bottom:10px;box-shadow:0 2px 6px rgba(0,0,0,0.04);border-left:4px solid #667eea;"><div style="display:flex;justify-content:space-between;align-items:flex-start;gap:10px;"><div style="flex:1;"><strong>${c.nome}</strong><br/><span class="muted">CPF: ${c.cpf}</span><br/><span class="muted">Seguro: ${c.tipoSeguro} | Filiado desde: ${c.dataFiliacao}</span><br/><span class="badge-pontos">‚≠ê ${saldo} pontos (R$ ${reais})</span><div class="points-bar"><div class="points-bar-fill" style="width:${perc}%;"></div></div></div><button class="btn-sm-danger" onclick="excluirCliente('${c.id}')">Deletar</button></div></div>`;
            }).join('');
        }

        function atualizarDescricaoAcumulo() {
            const tipo = document.querySelector('input[name="tipoAcumulo"]:checked')?.value;
            document.getElementById('areaCustomizada').style.display = tipo === 'customizado' ? 'block' : 'none';
        }

        function adicionarPontos() {
            const clienteId = document.getElementById('clienteAcumulo').value;
            const tipoAcumulo = document.querySelector('input[name="tipoAcumulo"]:checked')?.value;
            if (!clienteId || !tipoAcumulo) { alert('Selecione um cliente e tipo de ac√∫mulo.'); return; }

            let pontos = 0, descricao = '';
            if (tipoAcumulo === 'renovacao') { pontos = 500; descricao = 'Renova√ß√£o Antecipada (5 dias antes)'; }
            else if (tipoAcumulo === 'produto2') { pontos = 1000; descricao = 'Contrata√ß√£o de 2¬∫ Produto'; }
            else if (tipoAcumulo === 'indicacao') { pontos = 1500; descricao = 'Indica√ß√£o Efetivada'; }
            else if (tipoAcumulo === 'aula') { pontos = 200; descricao = 'Aluno da Aula Habilitado'; }
            else if (tipoAcumulo === 'customizado') {
                pontos = parseInt(document.getElementById('pontosCustomizados').value) || 0;
                descricao = document.getElementById('motivoCustomizado').value || 'Pontua√ß√£o Customizada';
                if (pontos <= 0) { alert('Digite uma quantidade v√°lida de pontos.'); return; }
            }

            const cliente = estadoApp.clientes.find(c => c.id === clienteId);
            if (!cliente) return;
            cliente.pontos = (cliente.pontos || 0) + pontos;
            estadoApp.movimentos.push({ id: gerarId(), clienteId, clienteNome: cliente.nome, tipo: 'acumulo', pontos, descricao, observacao: document.getElementById('observacaoAcumulo').value || '', data: new Date().toLocaleString('pt-BR') });
            salvarEstado();
            document.getElementById('observacaoAcumulo').value = '';
            document.querySelectorAll('input[name="tipoAcumulo"]').forEach(r => r.checked = false);
            document.getElementById('areaCustomizada').style.display = 'none';
            atualizarTudo();
            alert(`${pontos} pontos adicionados para ${cliente.nome}.`);
        }

        function atualizarResgate() {
            const tipo = document.querySelector('input[name="tipoResgate"]:checked')?.value;
            const detalheDiv = document.getElementById('detalheResgate');
            const detalhesEsp = document.getElementById('detalhesEspecificos');
            if (!tipo) { detalheDiv.style.display = 'none'; return; }

            detalhesEsp.innerHTML = tipo === 'aula-consultoria' ? '<div class="form-row"><div><label>Tipo de Aula/Consultoria</label><select id="tipoAula"><option>Dire√ß√£o Defensiva em Rodovia</option><option>Consultoria de Coberturas</option><option>Webinar de Seguran√ßa</option><option>Orienta√ß√£o Financeira</option><option>Outro</option></select></div></div>' : (tipo === 'parceiros' ? '<div class="form-row"><div><label>Estabelecimento Parceiro</label><select id="nomeParceiro"><option>Lava-R√°pido XYZ</option><option>Oficina ABC</option><option>Restaurante Local</option><option>Sal√£o de Beleza</option><option>Outro</option></select></div></div>' : '');
            detalheDiv.style.display = 'block';

            const cliente = estadoApp.clientes.find(c => c.id === document.getElementById('clienteResgate').value);
            const info = document.getElementById('infoClienteResgate');
            if (cliente) {
                const saldo = cliente.pontos || 0;
                info.innerHTML = `<div class="info-box"><strong>${cliente.nome}</strong> ‚Äì CPF: ${cliente.cpf}<br/>Saldo Dispon√≠vel: <span style="font-size:18px;color:#667eea;">${saldo} pontos</span> (R$ ${(saldo/10).toFixed(2)})</div>`;
            } else info.innerHTML = '';
        }

        function atualizarEquivalente() {
            const pontos = parseInt(document.getElementById('pontosResgate').value) || 0;
            document.getElementById('equivalenteResgate').value = `R$ ${(pontos/10).toFixed(2)}`;
        }

        function confirmarResgate() {
            const clienteId = document.getElementById('clienteResgate').value;
            const tipo = document.querySelector('input[name="tipoResgate"]:checked')?.value;
            const pontos = parseInt(document.getElementById('pontosResgate').value) || 0;
            if (!clienteId || !tipo || pontos <= 0) { alert('Selecione cliente, tipo e pontos.'); return; }

            const cliente = estadoApp.clientes.find(c => c.id === clienteId);
            if (!cliente || pontos > (cliente.pontos || 0)) { alert('Saldo insuficiente.'); return; }
            if (pontos % 10 !== 0) { alert('M√∫ltiplo de 10.'); return; }

            let desc = tipo === 'desconto-renovacao' ? 'Desconto na Renova√ß√£o' : (tipo === 'aula-consultoria' ? `Voucher: ${document.getElementById('tipoAula').value}` : `Voucher: ${document.getElementById('nomeParceiro').value}`);
            cliente.pontos -= pontos;
            estadoApp.movimentos.push({ id: gerarId(), clienteId, clienteNome: cliente.nome, tipo: 'resgate', pontos, descricao: desc, observacao: document.getElementById('observacaoResgate').value || '', data: new Date().toLocaleString('pt-BR') });
            salvarEstado();
            document.getElementById('pontosResgate').value = '';
            document.getElementById('equivalenteResgate').value = '';
            document.getElementById('observacaoResgate').value = '';
            document.querySelectorAll('input[name="tipoResgate"]').forEach(r => r.checked = false);
            document.getElementById('detalheResgate').style.display = 'none';
            atualizarTudo();
            alert(`Resgate de ${pontos} pontos processado.`);
        }

        function atualizarHistorico() {
            const filtroId = document.getElementById('filtroHistorico').value;
            let dados = filtroId ? estadoApp.movimentos.filter(m => m.clienteId === filtroId) : estadoApp.movimentos;
            const ordenado = [...dados].reverse();
            document.getElementById('tabelaHistorico').innerHTML = !ordenado.length ? '<p class="muted">Nenhuma movimenta√ß√£o.</p>' : `<table class="table"><thead><tr><th>Data</th><th>Cliente</th><th>Tipo</th><th>Pontos</th><th>Descri√ß√£o</th></tr></thead><tbody>${ordenado.map(m => `<tr><td>${m.data}</td><td>${m.clienteNome}</td><td><span class="tag ${m.tipo === 'acumulo' ? 'tag-ganho' : 'tag-resgate'}">${m.tipo === 'acumulo' ? 'Ac√∫mulo' : 'Resgate'}</span></td><td>${m.tipo === 'acumulo' ? '+' : '-'}${m.pontos}</td><td>${m.descricao}</td></tr>`).join('')}</tbody></table>`;
        }

        function atualizarRelatorio() {
            const totalClientes = estadoApp.clientes.length;
            const saldoCirculacao = estadoApp.clientes.reduce((s,c) => s + (c.pontos || 0), 0);
            const resgatados = estadoApp.movimentos.filter(m => m.tipo === 'resgate').reduce((s,m) => s + m.pontos, 0);
            const acumulados = estadoApp.movimentos.filter(m => m.tipo === 'acumulo').reduce((s,m) => s + m.pontos, 0);
            const taxa = acumulados > 0 ? ((resgatados / acumulados) * 100).toFixed(1) : 0;

            document.getElementById('relClientes').textContent = totalClientes;
            document.getElementById('relPontosCirculacao').textContent = saldoCirculacao;
            document.getElementById('relPontosResgatados').textContent = resgatados;
            document.getElementById('relTaxaResgate').textContent = taxa + '%';
            document.getElementById('relInvestimento').textContent = `R$ ${((saldoCirculacao + resgatados)/10).toFixed(2)}`;

            const tipos = {};
            estadoApp.movimentos.filter(m => m.tipo === 'acumulo').forEach(m => {
                if (!tipos[m.descricao]) tipos[m.descricao] = { qtd:0, pts:0 };
                tipos[m.descricao].qtd++; tipos[m.descricao].pts += m.pontos;
            });
            document.getElementById('tabelaTiposAcao').innerHTML = Object.keys(tipos).length === 0 ? '<tr><td colspan="4" style="text-align:center;color:#999;">Nenhuma movimenta√ß√£o.</td></tr>' : Object.entries(tipos).map(([d,v]) => `<tr><td>${d}</td><td>${v.qtd}</td><td>${v.pts}</td><td>R$ ${(v.pts/10).toFixed(2)}</td></tr>`).join('');

            const top = [...estadoApp.clientes].sort((a,b) => (b.pontos || 0) - (a.pontos || 0)).slice(0,10);
            document.getElementById('tabelaTopClientes').innerHTML = !top.length ? '<tr><td colspan="4" style="text-align:center;color:#999;">Nenhum cliente.</td></tr>' : top.map(c => `<tr><td>${c.nome}</td><td>${c.pontos || 0}</td><td>R$ ${((c.pontos || 0)/10).toFixed(2)}</td><td><span class="tag" style="background:${(c.pontos||0)>=1000 ? '#fed7d7' : '#c6f6d5'};color:${(c.pontos||0)>=1000 ? '#742a2a' : '#22543d'};">${(c.pontos||0)>=1000 ? 'üî• Ativo' : '‚≠ê Regular'}</span></td></tr>`).join('');
        }

        function atualizarSelects() {
            const opcoes = estadoApp.clientes.map(c => `<option value="${c.id}">${c.nome} - ${c.cpf}</option>`).join('');
            const base = '<option value="">Selecione o Cliente...</option>';
            document.getElementById('clienteAcumulo').innerHTML = base + opcoes;
            document.getElementById('clienteResgate').innerHTML = base + opcoes;
            document.getElementById('filtroHistorico').innerHTML = '<option value="">Todos os Clientes</option>' + opcoes;
        }

        function atualizarTudo() { atualizarClientesLista(); atualizarSelects(); atualizarHistorico(); atualizarRelatorio(); }
        window.addEventListener('load', () => { carregarEstado(); atualizarTudo(); });
    </script>
</body>
</html>

